cmake_minimum_required(VERSION 2.8)
set(CMAKE_INSTALL_PREFIX /usr)
set (CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/CMake")
project(whisper-core)

execute_process(COMMAND git submodule init)
execute_process(COMMAND git submodule update)
execute_process(COMMAND cmake . WORKING_DIRECTORY jnxlibc)
execute_process(COMMAND make . WORKING_DIRECTORY jnxlibc)
execute_process(COMMAND sudo make install . WORKING_DIRECTORY jnxlibc)

include_directories(${PROJECT_INC_DIR}src/app)
include_directories(${PROJECT_INC_DIR}src/crypto)
include_directories(${PROJECT_INC_DIR}src/data)
include_directories(${PROJECT_INC_DIR}src/err)
include_directories(${PROJECT_INC_DIR}src/integrity)
include_directories(${PROJECT_INC_DIR}src/net)
include_directories(${PROJECT_INC_DIR}src/session)
include_directories(${PROJECT_INC_DIR}src/util)

execute_process(COMMAND ./tools/generate_protobuf)
file(GLOB HEADERS "src/**/*.h")
file(GLOB RAW_SRC "src/**/*.c")
file(COPY ${HEADERS} DESTINATION whisper-core)

add_library(whisper-core-static STATIC ${RAW_SRC})
add_library(whisper-core SHARED ${RAW_SRC})
target_link_libraries(whisper-core -ljnxc -lcrypto -lssl -g -lprotobuf-c -lncurses -lpthread)
target_link_libraries(whisper-core-static -ljnxc -lcrypto -lssl -g -lprotobuf-c -lncurses -lpthread)
install(TARGETS whisper-core-static DESTINATION ${INSTALL_PREFIX}/lib)
install(TARGETS whisper-core DESTINATION ${INSTALL_PREFIX}/lib)
install(DIRECTORY whisper-core DESTINATION ${INSTALL_PREFIX}/include)
